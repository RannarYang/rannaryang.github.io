var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXAnimation=function(){function t(t,e,i,r,s){if(this._currentFrame=0,this.oldTime=0,t){this._x=e,this._y=i,this._data=t,this._animations=[],this._currentFrame=0;var n=t.children;if(n)for(var o=0;o<n.length;o++){var h=n[o],a=new TMXAnimationFrame(h,e,i,r,s);this._animations[o]=a}}}var e=__define,i=t;return p=i.prototype,e(p,"x",function(){return this._x}),e(p,"y",function(){return this._y}),p.render=function(){this._currentFrame++,this._currentFrame=this._currentFrame%this._animations.length},e(p,"currentAnimationFrame",function(){return this._animations[this._currentFrame]}),e(p,"animations",function(){return this._animations}),e(p,"data",function(){return this._data}),t}();egret.registerClass(TMXAnimation,"TMXAnimation");var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXAnimationFrame=function(){function t(t,e,i,r,s){this._tiledid=+t.attributes.tileid,this._duration=+t.attributes.duration,this._tile=new TMXTile(e,i,this._tiledid+s.firstgid,r,s)}var e=__define,i=t;return p=i.prototype,e(p,"tile",function(){return this._tile}),e(p,"tiledId",function(){return this._tiledid}),e(p,"duration",function(){return this._duration}),t}();egret.registerClass(TMXAnimationFrame,"TMXAnimationFrame");var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXConstants=function(){function t(){}var e=t;return p=e.prototype,t.TMX_FLIP_H=2147483648,t.TMX_FLIP_V=1073741824,t.TMX_FLIP_AD=536870912,t.TMX_CLEAR_BIT_MASK=536870911,t.LAYER="layer",t.OBJECT_GROUP="objectgroup",t.PROPERTIES="properties",t.DATA="data",t.OBJECT="object",t.IMAGE="image",t.IMAGE_LAYER="imagelayer",t.TILE_SET="tileset",t.TILE="tile",t.TILE_OFFSET="tileoffset",t.ANIMATION="animation",t.DEFAULT_COLOR=10526884,t.DRAWORDER_INDEX="index",t.POLYGON="polygon",t.POLYLINE="polyline",t.ELLIPSE="ellipse",t.TILE_OBJECT_GROUP="tileobjectgroup",t.ORIENTATION_ORTHOGONAL="orthogonal",t.ORIENTATION_ISOMETRIC="isometric",t.ORIENTATION_STAGGERED="staggered",t.ORIENTATION_HEXAGONAL="hexagonal",t}();egret.registerClass(TMXConstants,"TMXConstants");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXImageLoadEvent=function(t){function e(e,i,r,s){void 0===i&&(i=null),void 0===r&&(r=!0),void 0===s&&(s=!1),t.call(this,e,r,s),this.texture=i}__extends(e,t);var i=e;return p=i.prototype,e.IMAGE_COMPLETE="complete",e.ALL_IMAGE_COMPLETE="allComplete",e}(egret.Event);egret.registerClass(TMXImageLoadEvent,"TMXImageLoadEvent");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXColorLayer=function(t){function e(e,i,r){t.call(this),this._tilemap=e,this._color=i,this._z=r,this.graphics.beginFill(TMXUtils.color16ToUnit(this._color),1),this.graphics.drawRect(0,0,e.renderwidth,e.renderheight),this.graphics.endFill()}__extends(e,t);var i=e;return p=i.prototype,e}(egret.Sprite);egret.registerClass(TMXColorLayer,"TMXColorLayer");var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TexturePool=function(){function t(){}var e=t;return p=e.prototype,t.addTexture=function(t,e){this.texturePools[t]=e},t.removeTexture=function(t){this.texturePools[t]=null},t.getTexture=function(t){return this.texturePools[t]},t.texturePools={},t}();egret.registerClass(TexturePool,"TexturePool");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXImageLayer=function(t){function e(e,i){t.call(this),this._tilemap=e,this._name=i.attributes.name,this.x=+i.attributes.x,this.y=+i.attributes.y,this._z=+i.attributes.z,this._opacity="undefined"!=typeof+i.attributes.opacity?+i.attributes.opacity:1,this.visible="undefined"!=typeof+i.attributes.visible?Boolean(+i.attributes.visible):!0;var r=i.children;if(r)for(var s=0;s<r.length;s++){var n=i.children[s];switch(n.localName){case TMXConstants.IMAGE:this._source=n.attributes.source,this._transColor=n.attributes.trans,this.loadImage(this.tilemap.baseURL+this._source);break;case TMXConstants.PROPERTIES:this._properties=this._tilemap.parseProperties(n)}}}__extends(e,t);var i=__define,r=e;return p=r.prototype,i(p,"tilemap",function(){return this._tilemap}),i(p,"bitmap",function(){return this._bitmap}),i(p,"z",function(){return this._z}),i(p,"name",function(){return this._name}),i(p,"alpha",function(){return this._opacity}),i(p,"transColor",function(){return this._transColor}),p.loadImage=function(t){var e=this;BitmapLoader.load(t,function(t){var i=TexturePool.getTexture(t);e._sourcebitmap=new egret.Bitmap(i),e.dispatchEvent(new TMXImageLoadEvent(TMXImageLoadEvent.IMAGE_COMPLETE,i))},[t])},p.draw=function(t){var e=new egret.RenderTexture,i=new egret.Rectangle(this.x,this.y,this._sourcebitmap.width,this._sourcebitmap.height);t=i.intersection(t),t.right=Math.ceil(this.tilemap.width/this.tilemap.tilewidth)*this.tilemap.tilewidth,t.bottom=Math.ceil(this.tilemap.height/this.tilemap.tileheight)*this.tilemap.tileheight,e.drawToTexture(this._sourcebitmap,t),this._bitmap=new egret.Bitmap,this._bitmap.texture=e,this._bitmap.alpha=this._opacity,this._bitmap.visible=this.visible,this.addChild(this._bitmap)},e}(egret.Sprite);egret.registerClass(TMXImageLayer,"TMXImageLayer");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXTile=function(t){function e(e,i,r,s,n){if(t.call(this),this._tileset=n,this._col=e,this._row=i,this._tilemap=s,this._gid=r,this._flippedX=0!==(this._gid&TMXConstants.TMX_FLIP_H),this._flippedY=0!==(this._gid&TMXConstants.TMX_FLIP_V),this._flippedAD=this._flippedX&&this._flippedY,this._flipped=this._flippedX||this._flippedY||this._flippedAD,this._gid&=TMXConstants.TMX_CLEAR_BIT_MASK,this._tileData=n.getSpecialTileDataByTileId(this._gid),this._tileData)for(var o=this._tileData.children,h=0;h<o.length;h++){var a=o[h];switch(a.localName){case TMXConstants.PROPERTIES:this._properties=s.parseProperties(a);break;case TMXConstants.OBJECT_GROUP:break;case TMXConstants.IMAGE:this._image=new TMXImage(a,this.tilemap.baseURL);break;case TMXConstants.ANIMATION:this._animation=new TMXAnimation(a,e,i,s,n)}}}__extends(e,t);var i=__define,r=e;return p=r.prototype,i(p,"gid",function(){return this._gid}),i(p,"col",function(){return this._col}),i(p,"row",function(){return this._row}),i(p,"tileset",function(){return this._tileset}),i(p,"image",function(){return this._image}),i(p,"tilemap",function(){return this._tilemap}),i(p,"flippedX",function(){return this._flippedX}),i(p,"flippedY",function(){return this._flippedY}),i(p,"flippedAD",function(){return this._flippedAD}),i(p,"flipped",function(){return this._flipped}),i(p,"animation",function(){return this._animation}),e}(egret.Sprite);egret.registerClass(TMXTile,"TMXTile");var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXTilesetGroup=function(){function t(t){this._tilesets=[],this._length=0,this._imagelength=0,this._tilemap=t}var e=__define,i=t;return p=i.prototype,e(p,"length",function(){return this._length}),e(p,"imagelength",function(){return this._imagelength}),e(p,"tilemap",function(){return this._tilemap}),p.add=function(t){this._tilesets.push(t),this._length++,t.image&&this._imagelength++},p.getTilesetByIndex=function(t){return this._tilesets[t]},p.getTilesetByGid=function(t){if(0===t)return null;var e=-1;t&=TMXConstants.TMX_CLEAR_BIT_MASK;for(var i=0,r=this._tilesets.length;r>i;i++){var s=this._tilesets[i];if(s.contains(t))return s;s.firstgid===s.lastgid&&t>=s.firstgid&&(e=i)}if(-1!==e)return this._tilesets[e];throw new Error("no matching tileset found for gid "+t)},t}();egret.registerClass(TMXTilesetGroup,"TMXTilesetGroup");var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},BitmapLoader=function(){function t(){}var e=t;return p=e.prototype,t.load=function(t,e,i){void 0===i&&(i=null);var r=TexturePool.getTexture(t);if(r)null!=e&&e.apply(null,i);else{var s={url:t,onComplete:e,onCompleteParams:i};this.startload(t,s)}},t.startload=function(t,e){RES.getResByUrl(t,this.onRESComplete,e)},t.onRESComplete=function(t){var e=this;TexturePool.addTexture(e.url,t),null!=e.onComplete&&e.onComplete.apply(null,e.onCompleteParams)},t}();egret.registerClass(BitmapLoader,"BitmapLoader");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXImage=function(t){function e(e,i){t.call(this,this),this._width=+e.attributes.width,this._height=+e.attributes.height,this._source=e.attributes.source,this._trans="undefined"!=typeof e.attributes.trans?+e.attributes.trans:1,this._source=i+this._source,this.loadImage(this._source)}__extends(e,t);var i=__define,r=e;return p=r.prototype,i(p,"texture",function(){return this._texture}),i(p,"source",function(){return this._source}),i(p,"bitmap",function(){return this._bitmap}),i(p,"width",function(){return this._width}),i(p,"height",function(){return this._height}),p.loadImage=function(t){var e=this;BitmapLoader.load(t,function(t){e._texture=TexturePool.getTexture(t),e._bitmap=new egret.Bitmap(e._texture),e.dispatchEvent(new TMXImageLoadEvent(TMXImageLoadEvent.IMAGE_COMPLETE,e._texture))},[t])},e}(egret.EventDispatcher);egret.registerClass(TMXImage,"TMXImage");var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXProperty=function(){function t(){this.gid=0}var e=t;return p=e.prototype,t}();egret.registerClass(TMXProperty,"TMXProperty");var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXRenderer=function(){function t(t,e,i,r){this.offsetsStaggerX=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],this.offsetsStaggerY=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}],this._cols=t,this._rows=e,this._tilewidth=i,this._tileheight=r,this.animationTiles=[]}var e=__define,i=t;return p=i.prototype,e(p,"cols",function(){return this._cols}),e(p,"rows",function(){return this._rows}),e(p,"tilewidth",function(){return this._tilewidth}),e(p,"tileheight",function(){return this._tileheight}),p.canRender=function(t){return this.cols===t.cols&&this.rows===t.rows&&this.tilewidth===t.tilewidth&&this.tileheight===t.tileheight},p.drawTileLayer=function(){},p.drawTile=function(){},p.render=function(t){if(this.animationTiles)for(var e=egret.getTimer(),i=0;i<this.animationTiles.length;i++){var r=this.animationTiles[i],s=r.tmxTile,n=r.pos,o=s.animation,h=o.currentAnimationFrame;e-o.oldTime>h.duration&&(o.oldBitmap&&o.oldBitmap.parent&&o.oldBitmap.parent.removeChild(o.oldBitmap),this.drawTile(t,n[0],n[1],h.tile),o.oldBitmap=h.tile.bitmap,o.oldTime=e,o.render())}},t}();egret.registerClass(TMXRenderer,"TMXRenderer");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXOrthogonalRenderer=function(t){function e(e,i,r,s){t.call(this,e,i,r,s)}__extends(e,t);var i=e;return p=i.prototype,p.canRender=function(e){return e.orientation===TMXConstants.ORIENTATION_ORTHOGONAL&&t.prototype.canRender.call(this,e)},p.pixelToTileCoords=function(t,e){return new egret.Point(this.pixelToTileX(t),this.pixelToTileY(e))},p.pixelToTileX=function(t){return Math.floor(t/this.tilewidth)},p.pixelToTileY=function(t){return Math.floor(t/this.tileheight)},p.tileToPixelCoords=function(t,e){return new egret.Point(t*this.tilewidth,e*this.tileheight)},p.drawTile=function(t,e,i,r){var s=r.tileset;s.drawTile(t,s.tileoffset.x+e*this.tilewidth,s.tileoffset.y+(i+1)*this.tileheight-s.tileheight,r)},p.drawTileLayer=function(t,e){var i=t.staticContainer,r=this.pixelToTileCoords(Math.floor(Math.max(e.x-(t.maxTileSize.width-t.tilewidth),0)),Math.floor(Math.max(e.y-(t.maxTileSize.height-t.tileheight),0))),s=this.pixelToTileCoords(Math.ceil(e.x+e.width+this.tilewidth),Math.ceil(e.y+e.height+this.tileheight));s.x=s.x>this.cols?this.cols:s.x,s.y=s.y>this.rows?this.rows:s.y;for(var n=r.y;n<s.y;n++)for(var o=r.x;o<s.x;o++){var h=t.layerData[o][n];h&&(h.animation?this.animationTiles.push({tmxTile:h,pos:[o,n]}):this.drawTile(i,o,n,h))}},e}(TMXRenderer);egret.registerClass(TMXOrthogonalRenderer,"TMXOrthogonalRenderer");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXIsometricRenderer=function(t){function e(e,i,r,s){t.call(this,e,i,r,s),this._hTilewidth=this.tilewidth/2,this._hTileheight=this.tileheight/2,this._originX=this.rows*this._hTilewidth}__extends(e,t);var i=e;return p=i.prototype,p.canRender=function(e){return e.orientation===TMXConstants.ORIENTATION_ISOMETRIC&&t.prototype.canRender.call(this,e)},p.pixelToTileCoords=function(t,e){Math.floor(this.pixelToTileX(t,e)),Math.floor(this.pixelToTileY(e,t));return new egret.Point(this.pixelToTileX(t,e),this.pixelToTileY(e,t))},p.pixelToTileX=function(t,e){e/this.tileheight+(t-this._originX)/this.tilewidth;return e/this.tileheight+(t-this._originX)/this.tilewidth},p.pixelToTileY=function(t,e){t/this.tileheight-(e-this._originX)/this.tilewidth;return t/this.tileheight-(e-this._originX)/this.tilewidth},p.tileToPixelCoords=function(t,e){return new egret.Point((t-e)*this._hTilewidth+this._originX,(t+e)*this._hTileheight)},p.drawTile=function(t,e,i,r){var s=r.tileset;s.drawTile(t,s.tileoffset.x+e,s.tileoffset.y+i-s.tileheight,r)},p.drawTileLayer=function(t,e){var i=t.staticContainer,r=t.tileset,s=r.tileoffset,n=this.pixelToTileCoords(e.x-r.tilewidth,e.y-r.tileheight);n=new egret.Point(Math.floor(n.x),Math.floor(n.y));var o=this.pixelToTileCoords(e.x+e.width+r.tilewidth,e.y+e.height+r.tileheight);o=new egret.Point(Math.ceil(o.x),Math.ceil(o.y));var h=this.tileToPixelCoords(o.x,o.y),a=this.tileToPixelCoords(n.x,n.y);a.x-=this._hTilewidth,a.y+=this.tileheight;var l=a.y-e.y>this._hTileheight,_=e.x-a.x<this._hTilewidth;l&&(_?(n.x--,a.x-=this._hTilewidth):(n.y--,a.x+=this._hTilewidth),a.y-=this._hTileheight);for(var p=Boolean(+l^+_),u=n.clone(),d=a.y;d-this.tileheight<h.y;d+=this._hTileheight){u.setTo(n.x,n.y);for(var c=a.x;c<h.x;c+=this.tilewidth){if(u.x>=0&&u.y>=0&&u.x<this.cols&&u.y<this.rows){var f=t.layerData[u.x][u.y];f&&(r=f.tileset,s=r.tileoffset,f&&(f.animation?this.animationTiles.push({tmxTile:f,pos:[s.x+c,s.y+d]}):this.drawTile(i,c,d,f)))}u.x++,u.y--}p?(n.y++,a.x-=this._hTilewidth,p=!1):(n.x++,a.x+=this._hTilewidth,p=!0)}},e}(TMXRenderer);egret.registerClass(TMXIsometricRenderer,"TMXIsometricRenderer");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXHexagonalRenderer=function(t){function e(e,i,r,s,n,o,h){t.call(this,e,i,r,s),this._hexsidelength=n,this._staggeraxis=o,this._staggerindex=h,this._sidelengthx=0,this._sidelengthy=0,"x"===o?this._sidelengthx=n:this._sidelengthy=n,this._sideoffsetx=(this.tilewidth-this._sidelengthx)/2,this._sideoffsety=(this.tileheight-this._sidelengthy)/2,this._columnwidth=this._sideoffsetx+this._sidelengthx,this._rowheight=this._sideoffsety+this._sidelengthy,this._centers=[new egret.Point,new egret.Point,new egret.Point,new egret.Point]}__extends(e,t);var i=e;return p=i.prototype,p.canRender=function(e){return e.orientation===TMXConstants.ORIENTATION_HEXAGONAL&&t.prototype.canRender.call(this,e)},p.pixelToTileCoords=function(t,e){"x"===this._staggeraxis?t-="old"===this._staggerindex?this._sidelengthx:this.tilewidth:e-="old"===this._staggerindex?this._sideoffsety:this.tileheight;var i=new egret.Point(Math.floor(t/(this.tilewidth+this._sidelengthx)),Math.floor(e/(this.tileheight+this._sidelengthy))),r=new egret.Point(t-i.x*(this.tilewidth+this._sidelengthx),e-i.y*(this.tilewidth+this._sidelengthy));"x"===this._staggeraxis?(i.x=2*i.x,"even"===this._staggerindex&&++i.x):(i.y=2*i.y,"even"===this._staggerindex&&++i.y);var s,n,o,h;"x"===this._staggeraxis?(s=this._sidelengthx/2,o=s+this._columnwidth,h=this.tileheight/2,this._centers[0].setTo(s,h),this._centers[1].setTo(o,h-this._rowheight),this._centers[2].setTo(o,h+this._rowheight),this._centers[3].setTo(o+this._columnwidth,h)):(n=this._sidelengthy/2,o=this.tilewidth/2,h=n+this._rowheight,this._centers[0].setTo(o,n),this._centers[1].setTo(o-this._columnwidth,h),this._centers[2].setTo(o+this._columnwidth,h),this._centers[3].setTo(o,h+this._rowheight));for(var a,l=0,_=Number.MAX_VALUE,p=0;4>p;++p)a=Math.pow(this._centers[p].x-r.x,2)+Math.pow(this._centers[p].y-r.y,2),_>a&&(_=a,l=p);var u="x"===this._staggeraxis?this.offsetsStaggerX:this.offsetsStaggerY;return new egret.Point(i.x+u[l].x,i.y+u[l].y)},p.pixelToTileX=function(t,e){var i=this.pixelToTileCoords(t,e);return i.x},p.pixelToTileY=function(t,e){var i=this.pixelToTileCoords(e,t);return i.y},p.tileToPixelCoords=function(t,e){var i,r;return"x"===this._staggeraxis?(i=t*this._columnwidth,"odd"===this._staggerindex?(r=e*(this.tileheight+this._sidelengthy),r+=this._rowheight*(1&t)):(r=e*(this.tileheight+this._sidelengthy),r+=this._rowheight*(1-(1&t)))):(r=e*this._rowheight,"odd"===this._staggerindex?(i=t*(this.tilewidth+this._sidelengthx),i+=this._columnwidth*(1&e)):(i=t*(this.tilewidth+this._sidelengthx),i+=this._columnwidth*(1-(1&e)))),new egret.Point(i,r)},p.drawTile=function(t,e,i,r){var s=this.tileToPixelCoords(e,i),n=r.tileset;n.drawTile(t,n.tileoffset.x+s.x,n.tileoffset.y+s.y+(this.tileheight-n.tileheight),r)},p.drawTileLayer=function(t,e){var i=t.staticContainer,r=this.pixelToTileCoords(Math.floor(e.x),Math.floor(e.y)),s=this.pixelToTileCoords(Math.floor(e.x+e.width+this.tilewidth),Math.floor(e.y+e.height+this.tileheight));r.x=r.x<0?0:r.x,r.y=r.y<0?0:r.y,s.x=s.x>this.cols?this.cols:s.x,s.y=s.y>this.rows?this.rows:s.y;for(var n=r.y;n<s.y;n++)for(var o=r.x;o<s.x;o++){var h=t.layerData[o][n];h&&(h.animation?this.animationTiles.push({tmxTile:h,pos:[o,n]}):this.drawTile(i,o,n,h))}},e}(TMXRenderer);egret.registerClass(TMXHexagonalRenderer,"TMXHexagonalRenderer");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXTilemap=function(t){function e(e,i,r,s){t.call(this),this._tmxRenderer=null,this._data=r,this._renderWidth=e,this._renderHeight=i,this._cols=+r.attributes.width,this._rows=+r.attributes.height,this._tilewidth=+r.attributes.tilewidth,this._tileheight=+r.attributes.tileheight,this._nextobjectid=+r.attributes.nextobjectid,this._version=+r.attributes.version,this._orientation=r.attributes.orientation,this._renderorder=r.attributes.renderorder,this._baseURL=s,this._baseURL=decodeURIComponent(this._baseURL);var n=this._baseURL.lastIndexOf("/");this._baseURL=this._baseURL.slice(0,n+1),this._orientation===TMXConstants.ORIENTATION_ISOMETRIC?(this.width=(this._cols+this._rows)*(this._tilewidth/2),this.height=(this._cols+this._rows)*(this._tileheight/2)):(this.width=this._cols*this._tilewidth,this.height=this._rows*this._tileheight),this._hexsidelength=+r.attributes.hexsidelength,this._staggeraxis=r.attributes.staggeraxis||void 0,this._staggerindex=r.attributes.staggerindex||void 0,this._backgroundcolor=r.attributes.backgroundcolor,this._z=0,this._layers=[],this._objectGroups=[],null!==this._tmxRenderer&&this._tmxRenderer.canRender(this)||(this._tmxRenderer=this.getNewDefaultRenderer(this)),this._initialized=!1}__extends(e,t);var i=__define,r=e;return p=r.prototype,i(p,"nextobjectid",function(){return this._nextobjectid}),i(p,"tilewidth",function(){return this._tilewidth}),i(p,"tileheight",function(){return this._tileheight}),i(p,"baseURL",function(){return this._baseURL}),i(p,"renderwidth",function(){return this._renderWidth}),i(p,"renderheight",function(){return this._renderHeight}),p.parseProperties=function(t){var e,i=t.children;if(i){e=[];for(var r=0;r<i.length;r++){var s=i[r],n=new TMXProperty;n.name=s.attributes.name,n.value=s.attributes.value,e[r]=n}}return e},p.render=function(){for(var t=this.getLayers(),e=0;e<t.length;e++)this.addChild(t[e]);for(var i=this.getObjects(),e=0;e<i.length;e++)this.addChild(i[e]);this.addEventListener(egret.Event.ENTER_FRAME,this.onStartRendering,this)},p.getLayers=function(){return this.readMapObjects(this._data),this._layers},p.getObjects=function(){return this.readMapObjects(this._data),this._objectGroups},p.showHideBackground=function(t){this._showHideBackground=t;for(var e=0;e<this._layers.length;e++){var i=this._layers[e];if(i instanceof TMXColorLayer)return void(i.visible=t)}},p.destory=function(){this._tilesets=void 0,this._layers=[],this._objectGroups=[],this._initialized=!1,this.removeEventListener(egret.Event.ENTER_FRAME,this.onStartRendering,this)},p.readMapObjects=function(){if(this._initialized!==!0){var t=this._z,e=this;this._tilesets||(this._tilesets=new TMXTilesetGroup(this)),this._backgroundcolor&&this._showHideBackground&&this._layers.push(new TMXColorLayer(this,this._backgroundcolor,t++));var i=this._data.children;if(i)for(var r=0;r<i.length;r++){var s=i[r];switch(s.localName){case TMXConstants.TILE_SET:this._tilesets.add(new TMXTileset(this,s));break;case TMXConstants.LAYER:this._layers.push(this.parseLayer(s,t++));break;case TMXConstants.OBJECT_GROUP:this._objectGroups.push(this.parseObjectGroup(s,t++));break;case TMXConstants.PROPERTIES:this._properties=this.parseProperties(s);break;case TMXConstants.IMAGE_LAYER:this._layers.push(this.parseImageLayer(s,t++))}}for(var n=0,r=0;r<this._tilesets.length;r++){var o=this._tilesets.getTilesetByIndex(r);if(o.image){var h=function(){n++,n==this._tilesets.imagelength&&e.dispatchEvent(new TMXImageLoadEvent(TMXImageLoadEvent.ALL_IMAGE_COMPLETE))};o.image.addEventListener(TMXImageLoadEvent.IMAGE_COMPLETE,h,this)}}this._initialized=!0}},p.onStartRendering=function(){for(var t=this.getLayers(),e=0;e<t.length;e++){var i=t[e];i instanceof TMXLayer&&i.render()}for(var r=this.getObjects(),e=0;e<r.length;e++){r[e]}},p.getNewDefaultRenderer=function(t){switch(t._orientation){case"orthogonal":return new TMXOrthogonalRenderer(t._cols,t._rows,t._tilewidth,t._tileheight);case"isometric":return new TMXIsometricRenderer(t._cols,t._rows,t._tilewidth,t._tileheight);case"hexagonal":return new TMXHexagonalRenderer(t._cols,t._rows,t._tilewidth,t._tileheight,t._hexsidelength,t._staggeraxis,t._staggerindex);default:throw new Error(t._orientation+" type TMX Tile Map not supported!")}},p.parseLayer=function(t,e){var i=new TMXLayer(this,this._tilewidth,this._tileheight,this._orientation,this._tilesets,e,t);i.setRenderer(this._tmxRenderer.canRender(i)?this.getNewDefaultRenderer(this):this._tmxRenderer);var r=this,s=function(){this.draw(new egret.Rectangle(0,0,r._renderWidth,r._renderHeight))};return this.addEventListener(TMXImageLoadEvent.ALL_IMAGE_COMPLETE,s,i),i},p.parseObjectGroup=function(t,e){var i=new TMXObjectGroup(t,this._orientation,this._tilesets,e),r=this,s=function(){this.draw(new egret.Rectangle(0,0,r._renderWidth,r._renderHeight))};return this.addEventListener(TMXImageLoadEvent.ALL_IMAGE_COMPLETE,s,i),i},p.parseTileset=function(t){return new TMXTileset(t,this)},p.parseImageLayer=function(t,e){var i=this,r=new TMXImageLayer(this,t,e),s=function(){this.draw(new egret.Rectangle(0,0,i._renderWidth,i._renderHeight))};return r.addEventListener(TMXImageLoadEvent.IMAGE_COMPLETE,s,r),r},e}(egret.Sprite);egret.registerClass(TMXTilemap,"TMXTilemap");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},Ellipse=function(t){function e(e,i,r,s){t.call(this),this._x=e,this._y=i,this.width=r,this.height=s}__extends(e,t);var i=e;return p=i.prototype,p.draw=function(t){this.graphics.clear(),this.graphics.lineStyle(2,t),this.graphics.beginFill(t,.2),this.graphics.drawEllipse(this._x,this._y,this.width,this.height),this.graphics.endFill()},e}(egret.Sprite);egret.registerClass(Ellipse,"Ellipse");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},Polygon=function(t){function e(e,i,r){t.call(this),this._x=e,this._y=i,this._points=r}__extends(e,t);var i=e;return p=i.prototype,p.draw=function(t){if(this.graphics.clear(),this.graphics.lineStyle(2,t),this.graphics.beginFill(t,.2),this._points)for(var e=0;e<this._points.length;e++){var i=this._points[e];0==e?this.graphics.moveTo(i[0],i[1]):this.graphics.lineTo(i[0],i[1])}this.graphics.endFill()},e}(egret.Sprite);egret.registerClass(Polygon,"Polygon");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},PolyLine=function(t){function e(e,i,r){t.call(this),this._x=e,this._y=i,this._points=r}__extends(e,t);var i=e;return p=i.prototype,p.draw=function(t){if(this.graphics.clear(),this.graphics.lineStyle(2,t),this.graphics.beginFill(t,.2),this._points)for(var e=0;e<this._points.length;e++){var i=this._points[e];0==e?this.graphics.moveTo(i[0],i[1]):this.graphics.lineTo(i[0],i[1])}this.graphics.endFill()},e}(egret.Sprite);egret.registerClass(PolyLine,"PolyLine");var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXTileset=function(){function t(e,i){this.getFileExtension=function(t){return t.substring(t.lastIndexOf(".")+1,t.length)},this._tileDatas=[],t._cacheRenderTextures={},this._firstgid=+i.attributes.firstgid,this._lastgid=this._firstgid,this._tilemap=e;var r=i.attributes.source;if(r&&"tsx"===this.getFileExtension(r))throw new Error("tmx not support tsx file load!!!");this._transformMatrix=new egret.Matrix,this._name=i.attributes.name,this._tilewidth=+i.attributes.tilewidth,this._tileheight=+i.attributes.tileheight,this._spacing=+i.attributes.spacing||0,this._margin=+i.attributes.margin||0,this._tileoffset=new egret.Point,this._hTileCount=0,this._vTileCount=0;var s=i.children;if(s)for(var n=0;n<s.length;n++){var o=s[n];switch(o.localName){case TMXConstants.IMAGE:this._image=new TMXImage(o,this.tilemap.baseURL),this._imagesource=this._image.source;break;case TMXConstants.TILE_OFFSET:this._tileoffset=new egret.Point(+o.attributes.x,+o.attributes.y);break;case TMXConstants.TILE:var h=+o.attributes.id+this._firstgid;null==this._tileDatas[h]&&(this._tileDatas[h]=o);break;case TMXConstants.PROPERTIES:this._properties=e.parseProperties(o)}}this._image&&(this._hTileCount=~~(this._image.width/(this._tilewidth+this._spacing)),this._vTileCount=~~(this._image.height/(this._tileheight+this._margin)),this._lastgid=this._firstgid+(this._hTileCount*this._vTileCount-1||0))}var e=__define,i=t;return p=i.prototype,e(p,"name",function(){return this._name}),e(p,"firstgid",function(){return this._firstgid}),e(p,"lastgid",function(){return this._lastgid}),e(p,"tilewidth",function(){return this._tilewidth}),e(p,"tileheight",function(){return this._tileheight}),e(p,"spacing",function(){return this._spacing}),e(p,"margin",function(){return this._margin}),e(p,"tileoffset",function(){return this._tileoffset}),e(p,"horizontalTileCount",function(){return this._hTileCount}),e(p,"verticalTileCount",function(){return this._vTileCount}),e(p,"tilemap",function(){return this._tilemap}),e(p,"properties",function(){return this._properties}),e(p,"image",function(){return this._image}),p.getSpecialTileDataByTileId=function(t){return this._tileDatas[t]},p.getTileProperties=function(t){return this._properties[t]},p.contains=function(t){return t>=this._firstgid&&t<=this._lastgid},p.drawTile=function(e,i,r,s){var n,o=s.gid-this.firstgid,h=this.firstgid+"_"+o;if(h&&(null==t._cacheRenderTextures[h]?this.image&&(n=new egret.RenderTexture,n.drawToTexture(this.image.bitmap,new egret.Rectangle(o%this.horizontalTileCount*(this.tilewidth+this._spacing)+this._spacing,Math.floor(o/this.horizontalTileCount)*(this.tileheight+this._margin)+this._margin,this.tilewidth,this.tileheight)),t._cacheRenderTextures[h]=n):n=t._cacheRenderTextures[h],n)){var a=!1,l=!1;e instanceof TMXObject&&(l=!0,a=e.isImage),this._transformMatrix.identity();var _=l?e.width/n.textureWidth:1,p=l?e.height/n.textureHeight:1;s.flippedAD?(this._transformMatrix.scale(-1*_,-1*p),this._transformMatrix.translate(i+e.width*_,r+e.height*p)):s.flippedY?(this._transformMatrix.scale(1*_,-1*p),this._transformMatrix.translate(i,r+e.height*p)):s.flippedX?(this._transformMatrix.scale(-1*_,1*p),this._transformMatrix.translate(i+e.width*_,r)):(this._transformMatrix.scale(_,p),this._transformMatrix.translate(i,r+(l?n.textureHeight-e.height:0))),null==s.bitmap&&(s.bitmap=new egret.Bitmap),s.bitmap.texture=n,s.bitmap.matrix=this._transformMatrix,e.addChild(s.bitmap)}},t}();egret.registerClass(TMXTileset,"TMXTileset");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXLayer=function(t){function e(e,i,r,s,n,o,h){t.call(this),this._staticContainer=new egret.Sprite,this._staticContainer.cacheAsBitmap=!0,this.addChild(this._staticContainer),this._animationContainer=new egret.Sprite,this.addChild(this._animationContainer),this._tilemap=e,this._tilewidth=i,this._tileheight=r,this._orientation=s,this._tilesets=n,this.tileset=this._tilesets?this._tilesets.getTilesetByIndex(0):null,this.maxTileSize={width:0,height:0};for(var a=0;a<this._tilesets.length;a++){var l=this._tilesets.getTilesetByIndex(a);this.maxTileSize.width=Math.max(this.maxTileSize.width,l.tilewidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,l.tileheight)}this._name=h.attributes.name,this._cols=+h.attributes.width,this._rows=+h.attributes.height,this._opacity="undefined"!=typeof h.attributes.opacity?parseFloat(h.attributes.opacity):1,this.visible="undefined"!=typeof h.attributes.visible?Boolean(+h.attributes.visible):!0,this._hexsidelength=+h.attributes.hexsidelength,this._staggeraxis=h.attributes.staggeraxis,this._staggerindex=+h.attributes.staggerindex,"isometric"===this._orientation?(this.width=(this._cols+this._rows)*(this._tilewidth/2),this.height=(this._cols+this._rows)*(this._tileheight/2)):(this.width=this._cols*this._tilewidth,this.height=this._rows*this._tileheight),this.initArray(this._cols,this._rows);
var _=h.children;if(_)for(var a=0;a<_.length;a++){var p=_[a];switch(p.localName){case TMXConstants.DATA:this.setLayerData(TMXUtils.decode(p,p.attributes.encoding,p.attributes.compression));break;case TMXConstants.PROPERTIES:this._properties=this.tilemap.parseProperties(p);break;default:throw new Error("TMXTileMap decode Layer is Error："+p.localName)}}this.alpha=this._opacity,this.visible=this.visible}__extends(e,t);var i=__define,r=e;return p=r.prototype,i(p,"name",function(){return this._name}),i(p,"staticContainer",function(){return this._staticContainer}),i(p,"animationContainer",function(){return this._animationContainer}),i(p,"tilewidth",function(){return this._tilewidth}),i(p,"tileheight",function(){return this._tileheight}),i(p,"orientation",function(){return this._orientation}),i(p,"cols",function(){return this._cols}),i(p,"rows",function(){return this._rows}),i(p,"hexsidelength",function(){return this._hexsidelength}),i(p,"staggeraxis",function(){return this._staggeraxis}),i(p,"staggerindex",function(){return this.staggerindex}),i(p,"opacity",function(){return this._opacity}),i(p,"properties",function(){return this._properties}),i(p,"tilemap",function(){return this._tilemap}),p.setRenderer=function(t){this.renderer=t},p.getTileId=function(t,e){var i=this.getTile(t,e);return i?i.gid:0},p.getTile=function(t,e){return this.renderer instanceof TMXOrthogonalRenderer?this.layerData[~~this.renderer.pixelToTileX(t)][~~this.renderer.pixelToTileY(e)]:this.renderer instanceof TMXIsometricRenderer?this.layerData[~~this.renderer.pixelToTileX(t,e)][~~this.renderer.pixelToTileY(e,t)]:this.layerData[~~this.renderer.pixelToTileX(t,e)][~~this.renderer.pixelToTileY(e,t)]},p.setTile=function(t,e,i){if(this.tileset.contains(i)||(this.tileset=this._tilesets.getTilesetByGid(i)),this.tileset){var r=this.layerData[t][e]=new TMXTile(t,e,i,this.tilemap,this.tileset);return r}return null},p.clearTile=function(t,e){this.layerData[t][e]=null},p.draw=function(t){this.renderer.drawTileLayer(this,t)},p.render=function(){this.renderer.render(this._animationContainer)},p.initArray=function(t,e){this.layerData=[];for(var i=0;t>i;i++){this.layerData[i]=[];for(var r=0;e>r;r++)this.layerData[i][r]=null}},p.setLayerData=function(t){if(t)for(var e=0,i=0;i<this.rows;i++)for(var r=0;r<this.cols;r++){var s=t[e];0!==s&&this.setTile(r,i,s),e++}},e}(egret.Sprite);egret.registerClass(TMXLayer,"TMXLayer");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXObject=function(t){function e(e,i,r,s,n){if(t.call(this),this._points=void 0,this._name=e.attributes.name,this.x=+e.attributes.x,this.y=+e.attributes.y,this._z=+s,this.width=+e.attributes.width||0,this.height=+e.attributes.height||0,this._gid=+e.attributes.gid||null,this._type=e.attributes.type,this.rotation=+e.attributes.rotation||0,this._id=+e.attributes.id||void 0,this._orientation=i,this._shapes=void 0,this._color=n,this._isEllipse=!1,this._isPolygon=!1,this._isPolyLine=!1,this.visible="undefined"!=typeof e.attributes.visible?Boolean(+e.attributes.visible):!0,"number"==typeof this._gid)this._isImage=!0,this.setTile(r);else{this._points=[];var o=e.children;if(o)for(var h=0;h<o.length;h++){var a=o[h];switch(a.localName){case TMXConstants.ELLIPSE:this._isEllipse=!0,this._isImage=!1,this._ellipse=this.parseEllipse(a);break;case TMXConstants.POLYGON:this._isPolygon=!0,this._isImage=!1,this._points=this.parsePolygonOrPolyline(a.attributes.points);break;case TMXConstants.POLYLINE:this._isPolyLine=!0,this._isImage=!1,this._points=this.parsePolygonOrPolyline(a.attributes.points);break;case TMXConstants.PROPERTIES:r.tilemap&&(this._properties=r.tilemap.parseProperties(a))}}}this._shapes||(this._shapes=this.parseTMXShapes());for(var h=0;h<this._shapes.length;h++){var l=this._shapes[h];this.addChild(l)}}__extends(e,t);var i=__define,r=e;return p=r.prototype,i(p,"id",function(){return this._id}),i(p,"gid",function(){return this._gid}),i(p,"name",function(){return this._name}),i(p,"type",function(){return this._type}),i(p,"z",function(){return this._z}),i(p,"isEllipse",function(){return this._isEllipse}),i(p,"isPolygon",function(){return this._isPolygon}),i(p,"isPolyLine",function(){return this._isPolyLine}),i(p,"isImage",function(){return this._isImage}),p.getObjectPropertyByName=function(t){return this[t]},p.parsePolygonOrPolyline=function(t){var e=[],i=t.split(" ");if(i)for(var r=0;r<i.length;r++){var s=i[r].split(",");e[r]=[+s[0],+s[1]]}return e},p.parseEllipse=function(t){var e=+t.attributes.width||32,i=+t.attributes.height||32;return[e,i]},p.parseTMXShapes=function(){var t=[];if(this._isEllipse){var e=new Ellipse(0,0,this.width,this.height);e.draw(this._color),t.push(e)}else if(this._isPolygon){var i=new Polygon(0,0,this._points);i.draw(this._color),t.push(i)}else if(this._isPolyLine){var r=new PolyLine(0,0,this._points);r.draw(this._color),t.push(r)}else if(!this._gid){var i=new Polygon(0,0,[[0,0],[this.width,0],[this.width,this.height],[0,this.height]]);i.draw(this._color),t.push(i)}if("isometric"===this._orientation)for(var s=0;s<t.length;s++){var n=t[s];n.rotation=45,n.scaleX=Math.SQRT1_2,n.scaleY=Math.SQRT1_2}return t},p.setTile=function(t){var e=t.getTilesetByGid(this._gid);if(e){var i=e.image;if(i){var r=function(){};i.addEventListener(TMXImageLoadEvent.IMAGE_COMPLETE,r,this)}this._tile=new TMXTile(0,0,this.gid,e.tilemap,e),e.drawTile(this,e.tileoffset.x,e.tileoffset.y-e.tileheight,this._tile)}},e}(egret.Sprite);egret.registerClass(TMXObject,"TMXObject");var __extends=this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXObjectGroup=function(t){function e(e,i,r,s){t.call(this),this._name=e.attributes.name,this._opacity="undefined"!=typeof e.attributes.opacity?+e.attributes.opacity:1,this._draworder=e.attributes.draworder,this._color=e.attributes.color?TMXUtils.color16ToUnit(e.attributes.color):TMXConstants.DEFAULT_COLOR,this._orientaion=i,this._tilesets=r,this._z=s,this.visible="undefined"!=typeof e.attributes.visible?Boolean(+e.attributes.visible):!0,this._objects=[],this._objectHash={},this._childrens=e.children}__extends(e,t);var i=__define,r=e;return p=r.prototype,i(p,"name",function(){return this._name}),p.draw=function(){if(this._childrens)for(var t=0;t<this._childrens.length;t++){var e=new TMXObject(this._childrens[t],this._orientaion,this._tilesets,this._z,this._color);e.alpha=this._opacity,this._objects[t]=e,this.addChild(e),this._objectHash[e.id]=e}},p.render=function(){},p.destory=function(){this._objects=null},p.getObjectById=function(t){return this._objectHash[t]},p.removeObjectById=function(t){var e=this.getObjectById(t);e&&e.parent&&e.parent.removeChild(e)},p.showObjectById=function(t){var e=this.getObjectById(t);e&&(e.visible=!0)},p.hideObjectById=function(t){var e=this.getObjectById(t);e&&(e.visible=!1)},p.getObjectCount=function(){return this._objects.length},p.getObjectByIndex=function(t){return this._objects[t]},p.removeObjectByIndex=function(t){var e=this.getObjectByIndex(t);e&&e.parent&&e.parent.removeChild(e)},e}(egret.Sprite);egret.registerClass(TMXObjectGroup,"TMXObjectGroup");var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},Base64=function(){function t(){}var e=__define,i=t;return p=i.prototype,e(t,"nativeBase64",function(){return"function"==typeof window.atob}),t.decode=function(t){if(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),this.nativeBase64)return window.atob(t);for(var e,i,r,s,n,o,h,a=[],l=0;l<t.length;)s=this._keyStr.indexOf(t.charAt(l++)),n=this._keyStr.indexOf(t.charAt(l++)),o=this._keyStr.indexOf(t.charAt(l++)),h=this._keyStr.indexOf(t.charAt(l++)),e=s<<2|n>>4,i=(15&n)<<4|o>>2,r=(3&o)<<6|h,a.push(String.fromCharCode(e)),64!==o&&a.push(String.fromCharCode(i)),64!==h&&a.push(String.fromCharCode(r));return a=a.join("")},t.encode=function(t){if(t=t.replace(/\r\n/g,"\n"),!this.nativeBase64){for(var e,i,r,s,n,o,h,a=[],l=0;l<t.length;)e=t.charCodeAt(l++),i=t.charCodeAt(l++),r=t.charCodeAt(l++),s=e>>2,n=(3&e)<<4|i>>4,o=(15&i)<<2|r>>6,h=63&r,isNaN(i)?o=h=64:isNaN(r)&&(h=64),a.push(this._keyStr.charAt(s)),a.push(this._keyStr.charAt(n)),a.push(this._keyStr.charAt(o)),a.push(this._keyStr.charAt(h));return a=a.join("")}window.btoa(t)},t.decodeBase64AsArray=function(e,i){i=i||1;var r,s,n,o=t.decode(e),h=new Uint32Array(o.length/i);for(r=0,n=o.length/i;n>r;r++)for(h[r]=0,s=i-1;s>=0;--s)h[r]+=o.charCodeAt(r*i+s)<<(s<<3);return h},t.decompress=function(){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")},t.decodeCSV=function(t){for(var e=t.replace("\n","").trim().split(","),i=[],r=0;r<e.length;r++)i.push(+e[r]);return i},t._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t}();egret.registerClass(Base64,"Base64");var __define=this.__define||function(t,e,i,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r})},TMXUtils=function(){function t(){}var e=t;return p=e.prototype,t.create=function(t,e,i,r,s){void 0===s&&(s=null);var n=new egret.URLLoader;n.dataFormat=egret.URLLoaderDataFormat.TEXT,n.addEventListener(egret.Event.COMPLETE,function(n){try{var o=egret.XML.parse(n.target.data)}catch(h){throw new Error("tmx文件格式不正确！")}var a=new TMXTilemap(t,e,o,i);a.render(),r.addChild(a),null!=s&&s()},this),n.load(new egret.URLRequest(i)),n.addEventListener(egret.IOErrorEvent.IO_ERROR,function(){throw new Error("TMXTiledMap加载错误！！")},this)},t.decode=function(t,e,i){i=i||"none",e=e||"none";var r=t.children[0].text;switch(e){case"base64":var s=Base64.decodeBase64AsArray(r,4);return"none"===i?s:Base64.decompress(r,s,i);case"csv":return Base64.decodeCSV(r);case"none":for(var n=[],o=0;o<t.children.length;o++)n[o]=+t.children[o].attributes.gid;return n;default:throw new Error("未定义的编码:"+e)}},t.color16ToUnit=function(t){var e="0x"+t.slice(1);return parseInt(e,16)},t}();egret.registerClass(TMXUtils,"TMXUtils");